<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

    <title>Docker + Maven</title>

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/serif.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
        <style type="text/css">
            img {border-style: none !important}
        </style>
	</head>
	<body>
   	<div class="reveal">
<div class="slides">
    <section>
        <h1>Docker + Maven</h1>
        <h3>Building a tool for Docker to create and test containers.</p>
        <p>By Alex Collins</p>
        <aside class="notes">
            <p>Thank you!</p>
            <ol>
                <li>Who am I?</li>
                <li>Motivations for writing a tool.</li>
                <li>What does the tool do?</li>
                <li>Architecture of the tool.</li>
                <li>Two short demos.</li>
            </ol>
        </aside>
    </section>
    <section>
        <h2>Who Am I?</h2>
        <p class="fragment" ><img src="images/docker-maven-plugin/babs.png"/></p>
        <p class="fragment">"Recreational coder".</p>
        <aside class="notes">
            <ul>
                <li>Server Side Java Technical Lead Of Game Studio Gamesys.</li>
                <li>12 Years Of Enterprise Application Development Experience.</li>
                <li>Co-author of Selenium WebDriver In Practice.</li>
                <li>Like Andrew Martin who presented here in January - "I like lack of bugs".</li>
                <li>"Recreational coder". Google "I am a recreational coder" - 5 results.</li>
            </ul>
        </aside>
    </section>
    <section>
        <section>
            <h2>The WAR That Would Not Deploy</h2>
            <img src="images/docker-maven-plugin/eat-everything.jpg"/>
            <aside class="notes">
                <h3>Problems</h3>
                <ul>
                    <li>Regularly Broken.</li>
                    <li>Automatically Or Manually Deployed.</li>
                    <li>Angry QAs.</li>
                    <li>Nightly Test Suite Often Red (no feedback).</li>
                </ul>
                <h3>Cause</h3>
                <ul>
                    <li>Dozens Of Developers Committing To A Large Tree Of Dependencies.</li>
                </ul>
                <h3>Solution?</h3>
                <ul>
                    <li>Smoke test on the CI - bad WAR cannot get into the wild.</li>
                    <li>Send an IM notifcation to the the culprit.</li>
                    <li>QAs happy!</li>
                    <li>Test suite green, or red for the right reason.</li>
                </ul>
            </aside>
        </section>
        <section>
            <h2>Docker VirtualBox Plugin</h2>
            <p class="fragment"><img src="images/docker-maven-plugin/vbox-xml-files.png"/></p>
            <aside class="notes">
                <ul>
                    <li>Working on a software installer for Windows Server 2003. </li>
                    <li>Repeatedly install Windows onto a VirtualBox, copy and run scripts.</li>
                    <li>A plugin for the that builds and tests one or more VirtualBoxs - starting from nothing.</li>
                    <li>Masses of file I/O make writing the tool.</li>
                    <li>Even small amounts of I/O stack up if you do them a lot.</li>
                </ul>
            </aside>
        </section>
    </section>
    <section>
        <h1>Jan '14</h1>
        <p><i>"Alex - Have you heard of Docker?"</i></p>
        <aside class="notes">
            <p>I want my Docker applications to be tested before they get into the repository.</p>
            <p>Must write a plugin to do so.</p>
        </aside>
    </section>
    <section>
        <h2>What Does The Plugin Allow?</h2>
        <p>
            Define one or may of containers (e.g. databases, web servers, application servers) throught files, configure them (ports etc.), and manage them as part of the build.
        </p>
        <aside class="notes">
            <ol>
                <li>Allow you to run one or more images as part of the Maven project lifecycle.</li>
                <li>Version control a project with the images it depends on.</li>
                <li>Build containers using project artifacts.</li>
                <li>Test those built containers before deploying.</li>
                <li>Track image to the source code on it.</li>
            </ol>
        </aside>
    </section>
    <section>
        <section>
            <h1>Set-up</h1>
            <p><img src="images/docker-maven-plugin/drop-wizard-files.png"/></p>
        </section>
        <section>
            <h2>Maven <code>./pom.xml</code></h2>
            <pre><code><plugin>
    <groupId>com.alexecollins.docker</groupId>
    <artifactId>docker-maven-plugin</artifactId>
    <executions>
        <execution>
            <goals>
                <goal>clean</goal>
                <goal>validate</goal>
                <goal>package</goal> <!-- i.e. build -->
                <goal>start</goal>
                <goal>stop</goal>
                <goal>deploy</goal> <!-- i.e. push -->
            </goals>
        </execution>
    </executions>
</plugin></code></pre>
            <aside class="notes">
                <ol>
                    <li>Build file.</li>
                </ol>
            </aside>
        </section>
        <section>
            <h2><code>Dockerfile</code></h2>
            <pre><code>FROM dockerfile/java:oracle-java7

EXPOSE 8080
EXPOSE 9200
EXPOSE 9300

ADD ${project.build.finalName}.jar .

CMD java  -jar /${project.build.finalName}.jar</code></pre>
        </section>
        <section>
            <h2><code>conf.yml</code></h2>
            <pre><code>packaging:
  add:
    - target/${project.build.finalName}.jar
ports:
  - 8080
  - 9200
  - 9300
healthChecks:
  pings:
    - url: http://localhost:9200/
    - url: http://localhost:8080/
tag:
    alexec/searchinabox:${project.version}</code></pre>
        </section>
    </section>
    <section>
        <h2>Demo: ElasticSearch in a Box</h2>
        <p><small>Docker, Maven, Java, Spring Boot, Elastic Search, JUnit, Selenium WebDriver</small></p>
    </section>
    <section>
        <!--
	<p><a href="https://asciinema.org/a/18724?speed=2&autoplay=1" target="_blank"><img src="https://asciinema.org/a/18724.png" /></a></p>
-->
        <video autoplay>
            <source data-src="videos/search-in-a-box.mov"/>
        </video>
    </section>
    <section>
        <h2>Demo: Selenium Grid</h2>
        <p><small>Docker, Maven, Java, JUnit, Selenium Grid</small></p>
    </section>
    <section>
        <video autoplay>
            <source data-src="videos/selenium-visual-testing.mov"/>
        </video>
    </section>
    <section>
        <section>
            <h1>Tool Architecture</h1>
            <p><img src="images/docker-maven-plugin/cake.png"/></p>
        </section>
        <section>
            <h2>Layer 1: Docker API Client</h2>
            <aside class="notes">
                <ol>
                    <li>"docker-java"</li>
                    <li>Does all the authentication with the Docker daemon.</li>
                    <li>Can be replaced with test doubles for dependencies to ease testing.</li>
                </ol>
            </aside>
        </section>
        <section>
            <h2>Layer 2: Docker Orchestrator</h2>
            <aside class="notes">
                <ol>
                    <li>Meat - does heavy lifting.</li>
                    <li>Understand the configuration files.</li>
                    <li>Figures out image dependencies.</li>
                    <li>Acutally does the building images, and start/stop of containers.</li>
                    <li>Portable, can be use outside Maven.</li>
                    <li>Plugin-API (e.g. boot2docker).</li>
                </ol>
            </aside>
        </section>        
        <section>
            <h2>Layer 3: Maven Plugin</h2>
            <aside class="notes">
                <ol>
                    <li>Very hard to test plugins, so does very little.</li>
                    <li>Translate XML into set-up.</li>
                    <li>Best practise - do very little work.</li>
                </ol>
            </aside>
        </section>
    </section>
    <section>
        <h2>What's Next?</h2>
        <ul>
            <li>Gradle, Ant, and SBT Versions</li>
            <li>Docker Compose Compatibility</li>
        </ul>
    </section>  
    <section>
        <h1>Tips On Tools</h1>
        <aside class="notes">
            <ul>
                <li>Try and utilize maintained third-party components.</li>
                <li>Try and minimise file I/O.</li>
                <li>Don't rely on the network when testing. Can you build your tool offline.</li>
                <li>Think about how you can avoid repeating tasks, e.g. using caching.</li>
                <li>Use test-doubles to speed up development.</li>
                <li>When dealing with the OSS community, appreciate the help you get, but be careful of accepting pulls that don't have tests.</li>
                <li>Have a good selection of test cases.</li>
            </ul>
        </aside>
    </section>
    <section>
        <h1>End</h1>
        <p>
            <a href="http://www.alexecollins.com/tags/docker/">http://www.alexecollins.com/tags/docker</a>
            <a href="https://github.com/alexec/docker">https://github.com/alexec/docker</a>
        </p>
    </section>
</div>
</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: true,
                 slideNumber: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
